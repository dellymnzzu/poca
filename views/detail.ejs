<!doctype html>
<html lang="ko">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    
  



    <title>BUTTERFIY</title>
  </head>
  <body>
    
    
    <%- include('nav.html') %>



  
 
  <div class = "catainer mt-4">  
    <h3 class = "text-left pb-2">상세페이지</h3>
    
    <div class="card" style = "width: 100%;">
        <div class="card-header" id="header" name = "title">
           <%= data.제목 %>
        </div>
        

        <div class="card-btn">
          <button id="update" data-id="<%= data._id %>" style = "display: none;" >수정</button>
          <button id="delete" data-id="<%= data._id %>" style = "display: none;">삭제</button>
        </div>

        <div class="card-body">
          <div class="blockquote mb-0" name = "data">
            <p id = "body"> <%= data.내용 %> </p>
            
         
          </div>
        </div>
        
        <form action="/comment" method="post">

          <div class = comment>
            <div>
            
              <input type="text" id="Username" value="<%= data.작성자 %>" style = "display: none;">
            </div>
            <input type="text" name="parentnumber" value="<%= data._id %>" style = "display: none;">
              <label>내 아이디</label>
              <input type="text" id="commentwriter" value="<%= dataid.id %>">
            <textarea id="comment" name="comment" placeholder="내용 입력" required=""></textarea>
            <button class="btn" data-id="<%= data._id %>">댓글 달기</button>
            
          </div>
        </form>
        
        <% for (let i=0; i < commentdata.length; i++){ %>
        <ul class="list-group" value="<%= data._id %>">
             <li class="'list-group-item">
                <p ><%= commentdata[i].댓글작성자 %>: <%= commentdata[i].댓글 %></p>
             </li>
             <%  } %>
          </ul>  
          
    </div>
  </div>

  
  <script src="https://code.jquery.com/jquery-3.4.1.js"></script>

<script>
   var Username = $('#Username').val();
      console.log(Username);
      var name = $('#commentwriter').val();
      console.log(name);
  if(Username==name){
    $('#delete').show();
    $('#update').show();
    
  }
 
  
  
  $('#update').click(function(e){
    var _id = e.target.dataset.id;
  
  window.location.replace('/detail/update/'+_id);   // url을 바꿔주세요
  
})
    

          
         
    
    

  
  
  $('#delete').click(function(e){
        var _id = e.target.dataset.id;
        console.log(_id);
       
          
         
        $.ajax({
      method : 'post',
      url : '/detail/delete',
      data : { _id : _id }
    }).then((result)=>{
      alert("삭제 성공!");
      window.location.href ='/qna'
      //AJAX 성공시 실행할 코드적기
    }).fail((xhr,code,err)=>{
      alert("삭제 실패했습니다 다시 도전해주시길 바랍니다.");
      //AJAX 실패시 실행할 코드적기
    });   
 })
       
        
       
      
     
        
        
     


</script>


        
        

      



    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script   src="https://code.jquery.com/jquery-3.6.0.min.js"   integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="   crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
    -->
  </body>
</html>